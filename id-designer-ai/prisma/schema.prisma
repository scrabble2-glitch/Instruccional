generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Project {
  id                  String    @id @default(cuid())
  name                String
  audience            String
  level               String
  durationHours       Int
  modality            String
  generalObjectives   String
  restrictions        String?
  availableResources  String?
  pedagogicalApproach String?
  evaluationApproach  String?
  language            String    @default("es")
  tone                String    @default("profesional")
  preferredModel      String    @default("gemini-2.5-flash")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  versions            Version[]

  @@index([createdAt])
}

model Version {
  id               String   @id @default(cuid())
  projectId        String
  versionNumber    Int
  promptSystem     String
  promptUser       String
  generationParams String
  requestPayload   String
  responseJson     String
  qualityReport    String
  tokenInput       Int      @default(0)
  tokenOutput      Int      @default(0)
  estimatedCostUsd Float    @default(0)
  cacheKey         String?
  fromCache        Boolean  @default(false)
  createdAt        DateTime @default(now())
  project          Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, versionNumber])
  @@index([projectId, createdAt])
}

model CacheEntry {
  id               String   @id @default(cuid())
  key              String   @unique
  model            String
  safetyMode       String
  requestPayload   String
  responseJson     String
  qualityReport    String
  tokenInput       Int      @default(0)
  tokenOutput      Int      @default(0)
  estimatedCostUsd Float    @default(0)
  createdAt        DateTime @default(now())
  expiresAt        DateTime

  @@index([expiresAt])
}
